# Avito Agent

Этот проект представляет собой агента для поиска и анализа товаров на Avito.

## Запуск сервера

Для запуска сервера выполните:

```bash
python -m uvicorn server:app --reload --port 8001 --log-level warning
```

## Запуск тестов

Для запуска тестов выполните:

```bash
pytest -v
```

## Хранение истории чатов

Проект теперь включает возможность хранения истории чатов в базе данных. Все диалоги с агентом сохраняются в таблицах `ChatSession` и `ChatMessage`, что позволяет отслеживать историю взаимодействий с агентом.

## Инструмент тестирования (qwen_tester)

Для тестирования агента через командную строку используйте инструмент в папке `qwen_tester`:

```bash
# Отправка сообщения серверу
python qwen_tester/chat_client.py "Ваше сообщение здесь"

# Просмотр текущей истории чата
python qwen_tester/chat_client.py --view

# Сброс истории чата
python qwen_tester/chat_client.py --reset

# Использование конкретной сессии чата в БД
python qwen_tester/chat_client.py --db-chat-id 1 "Ваше сообщение здесь"
```

## API для управления чатами

Доступны следующие API-эндпоинты для управления чатами:

- `GET /api/chats` - получить список всех сессий чатов
- `GET /api/chats/{chat_id}` - получить все сообщения для конкретной сессии чата
- `POST /api/chats` - создать новую сессию чата
- `POST /api/chats/{chat_id}/messages` - добавить сообщение в сессию чата
- `DELETE /api/chats/{chat_id}` - удалить сессию чата

## Перезапуск сервера

После внесения изменений в логику сервера (например, в промпты LLM) может потребоваться перезапуск сервера:

- В Windows: запустите `restart_server.bat`
- В Linux/macOS: запустите `restart_server.sh`