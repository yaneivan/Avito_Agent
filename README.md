# Avito Agent

Avito Agent - это агент для поиска и анализа товаров на Avito, использующий локальную LLM модель для обработки запросов пользователей и автоматизации поиска.

## Архитектура

Проект разделен на следующие уровни:

- **models** - модели данных
- **repositories** - репозитории для работы с базой данных
- **services** - бизнес-логика
- **api** - эндпоинты API
- **utils** - вспомогательные утилиты
- **tests** - тесты

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Убедитесь, что локальная LLM модель запущена на `http://localhost:8080/v1`

3. Запустите приложение:
```bash
python main.py
```

## Использование

Приложение запускается на порту 8001. Основные эндпоинты:

- `POST /market_research` - создание нового исследования
- `GET /market_research/{id}` - получение исследования
- `POST /chat/{id}` - добавление сообщения в чат
- `GET /get_task` - получение задачи для расширения
- `POST /submit_results` - отправка результатов от расширения

## Интеграция с браузерным расширением

Проект включает в себя полную интеграцию с браузерным расширением:

- Расширение опрашивает сервер по эндпоинту `/get_task` для получения новых задач
- Расширение отправляет результаты по эндпоинту `/submit_results`
- Сервер обрабатывает результаты в зависимости от типа задачи (quick или deep)

## Обработка изображений

- Изображения товаров сохраняются в директорию, указанную в `IMAGE_STORAGE_PATH`
- Реализована защита от дубликатов с использованием хеширования
- Изображения используются для визуального анализа товаров с помощью LLM

## Тестирование

Для запуска тестов используйте:
```bash
pytest
```

## Особенности

- Поддержка двух режимов поиска: quick и deep
- Турнирный реранкинг для сортировки результатов
- Структурированный анализ товаров с использованием схем
- Поддержка визуального анализа товаров
- Состояния конечного автомата для управления процессом
- Полная интеграция с браузерным расширением
- Обработка и хранение изображений товаров